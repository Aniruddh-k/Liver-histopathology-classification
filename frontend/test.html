<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liver Fibrosis Classification System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        medical: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            200: '#bae6fd',
                            300: '#7dd3fc',
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            800: '#075985',
                            900: '#0c4a6e'
                        },
                        success: {
                            50: '#f0fdf4',
                            100: '#dcfce7',
                            200: '#bbf7d0',
                            300: '#86efac',
                            400: '#4ade80',
                            500: '#22c55e',
                            600: '#16a34a',
                            700: '#15803d',
                            800: '#166534',
                            900: '#14532d'
                        },
                        warning: {
                            50: '#fffbeb',
                            100: '#fef3c7',
                            200: '#fde68a',
                            300: '#fcd34d',
                            400: '#fbbf24',
                            500: '#f59e0b',
                            600: '#d97706',
                            700: '#b45309',
                            800: '#92400e',
                            900: '#78350f'
                        },
                        danger: {
                            50: '#fef2f2',
                            100: '#fee2e2',
                            200: '#fecaca',
                            300: '#fca5a5',
                            400: '#f87171',
                            500: '#ef4444',
                            600: '#dc2626',
                            700: '#b91c1c',
                            800: '#991b1b',
                            900: '#7f1d1d'
                        },
                        purple: {
                            50: '#faf5ff',
                            100: '#f3e8ff',
                            200: '#e9d5ff',
                            300: '#d8b4fe',
                            400: '#c084fc',
                            500: '#a855f7',
                            600: '#9333ea',
                            700: '#7c3aed',
                            800: '#6b21a8',
                            900: '#581c87'
                        }
                    },
                    backgroundImage: {
                        'gradient-radial': 'radial-gradient(var(--tw-gradient-stops))',
                        'gradient-medical': 'linear-gradient(135deg, #0ea5e9 0%, #3b82f6 50%, #8b5cf6 100%)',
                        'gradient-success': 'linear-gradient(135deg, #10b981 0%, #059669 100%)',
                        'gradient-warning': 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)',
                        'gradient-danger': 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 min-h-screen">
    <!-- Header -->
    <header class="bg-white/80 backdrop-blur-sm shadow-lg border-b border-gradient-to-r from-medical-200 to-purple-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-6">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <div class="h-12 w-12 bg-gradient-medical rounded-xl flex items-center justify-center shadow-lg">
                            <svg class="h-7 w-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                        </div>
                    </div>
                    <div class="ml-4">
                        <h1 class="text-3xl font-bold bg-gradient-to-r from-medical-700 to-purple-700 bg-clip-text text-transparent">
                            Liver Fibrosis Classification
                        </h1>
                        <p class="text-sm text-slate-600 font-medium">AI-Powered Ultrasound Analysis System</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="inline-flex items-center px-4 py-2 rounded-full text-sm font-semibold bg-gradient-success text-white shadow-lg">
                        <div class="w-2 h-2 bg-white rounded-full mr-2 animate-pulse"></div>
                        System Online
                    </span>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Upload Section -->
            <div class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-xl border border-white/20">
                <div class="p-8">
                    <div class="flex items-center mb-6">
                        <div class="h-8 w-8 bg-gradient-to-r from-medical-500 to-purple-500 rounded-lg flex items-center justify-center mr-3">
                            <svg class="h-5 w-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                            </svg>
                        </div>
                        <h2 class="text-xl font-bold text-slate-800">Upload Ultrasound Image</h2>
                    </div>
                    
                    <!-- Upload Area -->
                    <div id="uploadArea" class="border-3 border-dashed border-slate-300 rounded-2xl p-10 text-center hover:border-medical-400 hover:bg-gradient-to-br hover:from-medical-50 hover:to-purple-50 transition-all duration-300 cursor-pointer group">
                        <div class="bg-gradient-to-br from-medical-100 to-purple-100 rounded-full w-20 h-20 flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform duration-300">
                            <svg class="h-10 w-10 text-medical-600" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                                <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                        </div>
                        <div class="mt-4">
                            <p class="text-lg text-slate-700 font-semibold">
                                <span class="bg-gradient-to-r from-medical-600 to-purple-600 bg-clip-text text-transparent">Click to upload</span> or drag and drop
                            </p>
                            <p class="text-sm text-slate-500 mt-2 font-medium">PNG, JPG, JPEG up to 10MB</p>
                        </div>
                        <input type="file" id="imageInput" class="hidden" accept="image/*">
                    </div>

                    <!-- Preview Image -->
                    <div id="imagePreview" class="mt-8 hidden">
                        <h3 class="text-lg font-bold text-slate-800 mb-4 flex items-center">
                            <div class="w-3 h-3 bg-gradient-to-r from-success-400 to-success-600 rounded-full mr-2"></div>
                            Original Image
                        </h3>
                        <div class="border-2 border-slate-200 rounded-2xl overflow-hidden shadow-lg">
                            <img id="previewImg" class="w-full h-80 object-contain bg-gradient-to-br from-slate-50 to-slate-100" alt="Uploaded ultrasound">
                        </div>
                    </div>

                    <!-- Analyze Button -->
                    <button id="analyzeBtn" class="w-full mt-8 bg-gradient-medical text-white py-4 px-6 rounded-2xl font-bold text-lg hover:shadow-2xl hover:scale-105 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 hidden shadow-xl">
                        <span id="analyzeText">üî¨ Analyze Image</span>
                        <svg id="loadingSpinner" class="hidden animate-spin -mr-1 ml-3 h-6 w-6 text-white inline" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Results Section -->
            <div class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-xl border border-white/20">
                <div class="p-8">
                    <div class="flex items-center mb-6">
                        <div class="h-8 w-8 bg-gradient-to-r from-purple-500 to-pink-500 rounded-lg flex items-center justify-center mr-3">
                            <svg class="h-5 w-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2-2V7a2 2 0 012-2h2a2 2 0 002-2V1a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 002 2h2a2 2 0 012 2v2a2 2 0 00-2 2h-2a2 2 0 00-2 2v6a2 2 0 01-2 2H9z"></path>
                            </svg>
                        </div>
                        <h2 class="text-xl font-bold text-slate-800">Classification Results</h2>
                    </div>
                    
                    <div id="resultsContainer" class="hidden">
                        <!-- Prediction Result -->
                        <div class="bg-gradient-to-br from-medical-50 to-purple-50 border-2 border-medical-200 rounded-2xl p-6 mb-8 shadow-lg">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-bold text-slate-800 flex items-center">
                                    <span class="text-2xl mr-2">üéØ</span>
                                    Predicted Class
                                </h3>
                                <span id="confidenceScore" class="text-sm font-semibold bg-white/80 px-3 py-1 rounded-full text-slate-600">Confidence: 95.2%</span>
                            </div>
                            <div class="flex items-center space-x-4">
                                <div class="bg-gradient-medical text-white rounded-2xl p-4 shadow-lg">
                                    <span id="predictedClass" class="text-4xl font-black">F2</span>
                                </div>
                                <div>
                                    <p id="className" class="text-2xl font-bold text-slate-800">Periportal Fibrosis</p>
                                    <p id="classDescription" class="text-lg text-slate-600 font-medium">Moderate fibrosis extending beyond portal areas</p>
                                </div>
                            </div>
                        </div>

                        <!-- Fibrosis Scale -->
                        <div class="mb-8">
                            <h3 class="text-lg font-bold text-slate-800 mb-4 flex items-center">
                                <span class="text-xl mr-2">üìä</span>
                                Fibrosis Scale Reference
                            </h3>
                            <div class="space-y-3">
                                <div class="flex items-center justify-between p-4 rounded-xl bg-gradient-to-r from-success-100 to-success-200 border-2 border-success-300 shadow-md hover:shadow-lg transition-shadow">
                                    <div class="flex items-center">
                                        <span class="font-black text-2xl text-success-800 bg-white/80 rounded-lg px-3 py-1 mr-4">F0</span>
                                        <span class="text-lg font-bold text-success-800">No Fibrosis</span>
                                    </div>
                                    <div class="w-4 h-4 bg-success-500 rounded-full"></div>
                                </div>
                                <div class="flex items-center justify-between p-4 rounded-xl bg-gradient-to-r from-warning-100 to-warning-200 border-2 border-warning-300 shadow-md hover:shadow-lg transition-shadow">
                                    <div class="flex items-center">
                                        <span class="font-black text-2xl text-warning-800 bg-white/80 rounded-lg px-3 py-1 mr-4">F1</span>
                                        <span class="text-lg font-bold text-warning-800">Portal Fibrosis</span>
                                    </div>
                                    <div class="w-4 h-4 bg-warning-500 rounded-full"></div>
                                </div>
                                <div class="flex items-center justify-between p-4 rounded-xl bg-gradient-to-r from-orange-100 to-orange-200 border-2 border-orange-300 shadow-md hover:shadow-lg transition-shadow">
                                    <div class="flex items-center">
                                        <span class="font-black text-2xl text-orange-800 bg-white/80 rounded-lg px-3 py-1 mr-4">F2</span>
                                        <span class="text-lg font-bold text-orange-800">Periportal Fibrosis</span>
                                    </div>
                                    <div class="w-4 h-4 bg-orange-500 rounded-full"></div>
                                </div>
                                <div class="flex items-center justify-between p-4 rounded-xl bg-gradient-to-r from-danger-100 to-danger-200 border-2 border-danger-300 shadow-md hover:shadow-lg transition-shadow">
                                    <div class="flex items-center">
                                        <span class="font-black text-2xl text-danger-800 bg-white/80 rounded-lg px-3 py-1 mr-4">F3</span>
                                        <span class="text-lg font-bold text-danger-800">Septal Fibrosis</span>
                                    </div>
                                    <div class="w-4 h-4 bg-danger-500 rounded-full"></div>
                                </div>
                                <div class="flex items-center justify-between p-4 rounded-xl bg-gradient-to-r from-red-200 to-red-300 border-2 border-red-400 shadow-md hover:shadow-lg transition-shadow">
                                    <div class="flex items-center">
                                        <span class="font-black text-2xl text-red-900 bg-white/80 rounded-lg px-3 py-1 mr-4">F4</span>
                                        <span class="text-lg font-bold text-red-900">Cirrhosis</span>
                                    </div>
                                    <div class="w-4 h-4 bg-red-600 rounded-full"></div>
                                </div>
                            </div>
                        </div>

                        <!-- GradCAM Visualization -->
                        <div>
                            <h3 class="text-lg font-bold text-slate-800 mb-3 flex items-center">
                                <span class="text-xl mr-2">üî•</span>
                                GradCAM Visualization
                            </h3>
                            <p class="text-sm text-slate-600 mb-4 font-medium bg-slate-100 p-3 rounded-lg">
                                Heat map showing regions of interest for classification
                            </p>
                            <div class="border-2 border-slate-200 rounded-2xl overflow-hidden bg-gradient-to-br from-slate-50 to-slate-100 shadow-lg">
                                <img id="gradcamImg" class="w-full h-80 object-contain" alt="GradCAM visualization">
                            </div>
                        </div>
                    </div>

                    <!-- Placeholder when no results -->
                    <div id="noResults" class="text-center py-16">
                        <div class="bg-gradient-to-br from-slate-100 to-slate-200 rounded-full w-24 h-24 flex items-center justify-center mx-auto mb-6">
                            <svg class="h-12 w-12 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2-2V7a2 2 0 012-2h2a2 2 0 002-2V1a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 002 2h2a2 2 0 012 2v2a2 2 0 00-2 2h-2a2 2 0 00-2 2v6a2 2 0 01-2 2H9z"></path>
                            </svg>
                        </div>
                        <h3 class="text-xl font-bold text-slate-700 mb-2">No Analysis Yet</h3>
                        <p class="text-lg text-slate-500 font-medium">Upload an ultrasound image to begin classification</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Additional Information -->
        <div class="mt-12 bg-white/90 backdrop-blur-sm rounded-2xl shadow-xl border border-white/20">
            <div class="p-8">
                <div class="flex items-center mb-6">
                    <div class="h-8 w-8 bg-gradient-to-r from-indigo-500 to-purple-500 rounded-lg flex items-center justify-center mr-3">
                        <svg class="h-5 w-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                    <h2 class="text-2xl font-bold bg-gradient-to-r from-indigo-700 to-purple-700 bg-clip-text text-transparent">
                        About Liver Fibrosis Classification
                    </h2>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="bg-gradient-to-br from-blue-50 to-indigo-50 p-6 rounded-2xl border border-blue-200">
                        <h3 class="text-lg font-bold text-blue-800 mb-3 flex items-center">
                            <span class="text-xl mr-2">üî¨</span>
                            Classification System
                        </h3>
                        <p class="text-blue-700 font-medium leading-relaxed">
                            The METAVIR scoring system is used to assess the degree of liver fibrosis from F0 (no fibrosis) to F4 (cirrhosis). 
                            This AI model analyzes ultrasound images to provide automated classification assistance.
                        </p>
                    </div>
                    <div class="bg-gradient-to-br from-amber-50 to-orange-50 p-6 rounded-2xl border border-amber-200">
                        <h3 class="text-lg font-bold text-amber-800 mb-3 flex items-center">
                            <span class="text-xl mr-2">‚ö†Ô∏è</span>
                            Important Notice
                        </h3>
                        <p class="text-amber-700 font-medium leading-relaxed">
                            This tool is for research and educational purposes only. Results should not be used for clinical diagnosis 
                            without proper medical supervision and validation by qualified healthcare professionals.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Fibrosis class information with enhanced styling
        const fibrosisClasses = {
            'F0': {
                name: 'No Fibrosis',
                description: 'Normal liver tissue with no signs of fibrosis',
                color: 'success',
                gradient: 'from-success-400 to-success-600'
            },
            'F1': {
                name: 'Portal Fibrosis',
                description: 'Fibrosis confined to portal areas without septa',
                color: 'warning',
                gradient: 'from-warning-400 to-warning-600'
            },
            'F2': {
                name: 'Periportal Fibrosis',
                description: 'Moderate fibrosis extending beyond portal areas',
                color: 'orange',
                gradient: 'from-orange-400 to-orange-600'
            },
            'F3': {
                name: 'Septal Fibrosis',
                description: 'Severe fibrosis with bridging septa formation',
                color: 'danger',
                gradient: 'from-danger-400 to-danger-600'
            },
            'F4': {
                name: 'Cirrhosis',
                description: 'Complete architectural distortion with nodule formation',
                color: 'red',
                gradient: 'from-red-500 to-red-700'
            }
        };

        // DOM elements
        const uploadArea = document.getElementById('uploadArea');
        const imageInput = document.getElementById('imageInput');
        const imagePreview = document.getElementById('imagePreview');
        const previewImg = document.getElementById('previewImg');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const analyzeText = document.getElementById('analyzeText');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const resultsContainer = document.getElementById('resultsContainer');
        const noResults = document.getElementById('noResults');

        // Upload area click handler
        uploadArea.addEventListener('click', () => {
            imageInput.click();
        });

        // Drag and drop handlers
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('border-medical-400', 'bg-gradient-to-br', 'from-medical-50', 'to-purple-50', 'scale-105');
        });

        uploadArea.addEventListener('dragleave', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('border-medical-400', 'bg-gradient-to-br', 'from-medical-50', 'to-purple-50', 'scale-105');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('border-medical-400', 'bg-gradient-to-br', 'from-medical-50', 'to-purple-50', 'scale-105');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFileUpload(files[0]);
            }
        });

        // File input change handler
        imageInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFileUpload(e.target.files[0]);
            }
        });

        // Handle file upload
        function handleFileUpload(file) {
            if (!file.type.startsWith('image/')) {
                alert('Please upload a valid image file.');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                previewImg.src = e.target.result;
                imagePreview.classList.remove('hidden');
                analyzeBtn.classList.remove('hidden');
                
                // Hide results when new image is uploaded
                resultsContainer.classList.add('hidden');
                noResults.classList.remove('hidden');
            };
            reader.readAsDataURL(file);
        }

        // Analyze button click handler
        analyzeBtn.addEventListener('click', async () => {
            // Show loading state
            analyzeBtn.disabled = true;
            analyzeText.textContent = 'üîÑ Analyzing...';
            loadingSpinner.classList.remove('hidden');

            try {
                // Create FormData for API call
                const formData = new FormData();
                formData.append('file', imageInput.files[0]);

                // TODO: Replace with your FastAPI endpoint
                // const response = await fetch('http://localhost:8000/classify', {
                //     method: 'POST',
                //     body: formData
                // });
                // const result = await response.json();

                // Simulate API call for demo
                await new Promise(resolve => setTimeout(resolve, 3000));
                
                // Mock result - replace with actual API response
                const result = {
                    predicted_class: 'F2',
                    confidence: 0.952,
                    gradcam_image: '/placeholder.svg?height=320&width=320' // This should be the base64 or URL from your API
                };

                displayResults(result);

            } catch (error) {
                console.error('Error:', error);
                alert('An error occurred during analysis. Please try again.');
            } finally {
                // Reset button state
                analyzeBtn.disabled = false;
                analyzeText.textContent = 'üî¨ Analyze Image';
                loadingSpinner.classList.add('hidden');
            }
        });

        // Display results with enhanced animations
        function displayResults(result) {
            const classInfo = fibrosisClasses[result.predicted_class];
            
            // Update result elements
            document.getElementById('predictedClass').textContent = result.predicted_class;
            document.getElementById('className').textContent = classInfo.name;
            document.getElementById('classDescription').textContent = classInfo.description;
            document.getElementById('confidenceScore').textContent = `Confidence: ${(result.confidence * 100).toFixed(1)}%`;
            document.getElementById('gradcamImg').src = result.gradcam_image;

            // Show results with animation
            noResults.classList.add('hidden');
            resultsContainer.classList.remove('hidden');

            // Highlight the predicted class in the scale with enhanced styling
            const scaleItems = document.querySelectorAll('.space-y-3 > div');
            scaleItems.forEach((item, index) => {
                const className = `F${index}`;
                if (className === result.predicted_class) {
                    item.classList.add('ring-4', 'ring-purple-400', 'ring-opacity-75', 'transform', 'scale-105', 'shadow-2xl');
                    item.style.animation = 'pulse 2s infinite';
                } else {
                    item.classList.remove('ring-4', 'ring-purple-400', 'ring-opacity-75', 'transform', 'scale-105', 'shadow-2xl');
                    item.style.animation = '';
                }
            });
        }
    </script>
</body>
</html>